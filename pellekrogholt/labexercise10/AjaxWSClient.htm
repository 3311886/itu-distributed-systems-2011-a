<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Calling a Web service using Ajax functionality</title>

    <script type="text/javascript" language="javascript">

        var xmlhttp;

        function CallHelloWorld() {
            // Get XmlHttpObject
            xmlhttp = GetXmlHttpObject();

            if (xmlhttp == null) {
                alert("Your browser does not support XMLHTTP!");
                return;
            }


            var data = '<SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/">' +
                        '<SOAP-ENV:Header/>' +
                        "<SOAP-ENV:Body>" +
                        '<itu:helloOperation xmlns:itu="http://hello.samples.smds2011.itu.dk/">' +
                        "<arg0>" + document.getElementById("textyourname").value + "</arg0>" +
                        "</itu:helloOperation>" +
                        "</SOAP-ENV:Body>" +
                        "</SOAP-ENV:Envelope>";


            // Assign the URL of the web method you want to access.
            // If the web service supports HTTP Post operation, then URL of your web method 
            // will be in the following format.
            // [Web service URL]/[Operation Name]
            var url = "http://localhost:8085/labexercises/hello";

            xmlhttp.onreadystatechange = HelloWorldStateChanged;

            xmlhttp.open("post", url, true);

            xmlhttp.setRequestHeader("Content-Type", "text/xml; charset=utf-8");

            // This header is necessary to let the web service know that we are sending Form data,

            xmlhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

            xmlhttp.setRequestHeader('Access-Control-Allow-Origin','*');

            // We should send the data with necessary parameter name.
            xmlhttp.send(data);




        }



        function HelloWorldStateChanged() {

            if (xmlhttp.readyState == 4) {
                if (xmlhttp.status == 200) {
                    var xmlDoc = xmlhttp.responseXML;
                    console.log(xmlDoc.getElementsByTagName("return")[0].childNodes[0]);
                    document.getElementById("textareaHelloWorld").innerText = xmlDoc.getElementsByTagName("return")[0].childNodes[0].nodeValue;
                }
                else 
                {
                    alert('Call to HelloService failed! HTTP Status Code:' + xmlhttp.status);
                    document.getElementById("textareaHelloWorld").innerText = xmlhttp.responseText;
                }

            }

        }


        function GetXmlHttpObject() {
            if (window.XMLHttpRequest) {
                // code for IE7+, Firefox, Chrome, Opera, Safari
                return new XMLHttpRequest();
            }
            if (window.ActiveXObject) {
                // code for IE6, IE5
                return new ActiveXObject("Microsoft.XMLHTTP");
            }
            return null;
        }
    
    </script>

</head>
<body>
    <form action="" id="myform">
    <table>
        <tr>
        <td>Your Name: <input type="text" id="textyourname"  /></td>
            <td>
                <input id="buttonHelloWorld" type="button" onclick="CallHelloWorld()" value="Call Hello World" />
            </td>
            <td>
            </td>
        </tr>
        <tr>
            <td>
                Hello World web method response :
            </td>
            <td>
                <textarea id="textareaHelloWorld" cols="30" rows="5"></textarea>
            </td>
        </tr>

    </table>
    </form>
</body>
</html>
